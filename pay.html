<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Binance Pay Demo</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
  <h3>正在发起币安交易...</h3>
  <script>
    async function main() {
      const params = new URLSearchParams(window.location.search)
      const wallet = params.get("wallet")
      const chain = params.get("chain")
      const to = params.get("to")
      const amount = params.get("amount")

      if (wallet !== "binance") {
        document.body.innerHTML = "❌ 未指定币安钱包"
        return
      }

      if (!window.BinanceChain) {
        document.body.innerHTML = "❌ 未检测到币安钱包环境"
        return
      }

      try {
        await window.BinanceChain.request({ method: "eth_requestAccounts" })
        const provider = new ethers.providers.Web3Provider(window.BinanceChain)
        const signer = provider.getSigner()

        const tx = await signer.sendTransaction({
          to,
          value: ethers.utils.parseEther(amount)
        })

        document.body.innerHTML = "✅ 交易已发送，等待确认..."

        const receipt = await tx.wait()
        const hash = receipt.transactionHash
        document.body.innerHTML = "✅ 交易成功<br>Hash: " + hash

        // 回传 hash 给你的 App
        setTimeout(() => {
          const returnUrl = `yourappscheme://tx?txHash=${hash}`
          window.location.href = returnUrl
        }, 1000)
      } catch (err) {
        document.body.innerHTML = "❌ 交易失败: " + err.message
      }
    }
    main()
  </script>
</body>
</html>
